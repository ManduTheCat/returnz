node {  

    stage('checkout'){
       checkout scmGit(branches: [[name: '*/develop']], extensions: [], userRemoteConfigs: [[credentialsId: 'mandu', url: 'https://lab.ssafy.com/s08-bigdata-dist-sub2/S08P22C106.git']])
    }

    stage('FrontBuild') { 
        dir("front"){
            withEnv(['CI=false']) {
                nodejs('returnz') {
                    sh 'npm i'
                    sh 'npm run build'
                    sh 'pwd'
                    sh "rm -rf front"
                    sh "mv build front"
                }
            }
        }
    }


    stage('Test') { 
        // 
        
    }
    stage('Deploy') { 
        dir('front') {

            sshPublisher(publishers: [sshPublisherDesc(configName: 'returnz'
            ,transfers: 
            [sshTransfer(cleanRemote: false, 
            excludes: '', execCommand: 'ls -al', 
            execTimeout: 120000, 
            flatten: false, 
            makeEmptyDirs: false, 
            noDefaultExcludes: false, 
            patternSeparator: '[, ]+', 
            remoteDirectory: 'retrunz/', 
            remoteDirectorySDF: false, 
            removePrefix: '', 
            sourceFiles: 'front/')], 
            usePromotionTimestamp: false, 
            useWorkspaceInPromotion: false, 
            verbose: false)])
        }
    
    }
}   